name: Update Progress Badge

on:
  push:
    branches: [main]

jobs:
  update-progress:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Calculate Progress
        id: progress
        run: |
          # Count commits (10% per 5 commits, max 100%)
          COMMIT_COUNT=$(git rev-list --count HEAD)
          PROGRESS=$((COMMIT_COUNT * 2))
          if [ $PROGRESS -gt 100 ]; then
            PROGRESS=100
          fi
          echo "progress=$PROGRESS" >> $GITHUB_OUTPUT
          echo "Current progress: $PROGRESS%"
      
      - name: Update Progress JSON
        run: |
          echo '{"schemaVersion":1,"label":"Project Progress","message":"${{ steps.progress.outputs.progress }}%","color":"${{ steps.progress.outputs.progress >= 100 && 'brightgreen' || steps.progress.outputs.progress >= 50 && 'yellow' || 'orange' }}"}' > .github/badges/progress.json
      
      - name: Commit Progress Update
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          mkdir -p .github/badges
          echo '{"schemaVersion":1,"label":"ğŸ® Progress","message":"${{ steps.progress.outputs.progress }}%","color":"blue"}' > .github/badges/progress.json
          git add .github/badges/progress.json
          git diff --staged --quiet || git commit -m "ğŸ® Update progress: ${{ steps.progress.outputs.progress }}%"
          git push
